{"version":3,"file":"myLib.js","sources":["../src/defs.ts","../src/physics.ts","../src/heightmap.ts","../src/util.ts","../src/mouseinput.ts","../src/keyboardinput.ts","../src/editor.ts","../src/gameloop.ts","../src/viewport.ts","../src/editor-graphics.ts","../src/partitioning.ts","../src/test.ts","../src/view.ts","../src/welcome.ts","../src/main.ts"],"sourcesContent":["export const PLAYER_WIDTH = 1;\nexport const PLAYER_HEIGHT = 1.5;\nexport const GRAVITY = 10;\nexport const VIEWPORT_WIDTH = 40;\n\ninterface NumCallback {\n    (index:number): number\n}\n\nexport interface PlayerDef {\n    keyMap: KeyboardMap,\n    accentColor: string\n}\n\nexport type Player = ReturnType<typeof createPlayer>;\n\nexport const createPlayer = () => ({\n    score: 0,\n    droppedOutTime: -1,\n    accentColor: \"\",\n    pos: {x:0, y:0},\n    vel: {x:0, y:0},\n    angle: 0,\n    angleVel: 0,\n    touchesGround: false,\n    hasJumped: false,\n    input: {\n        rotateLeft: false,\n        rotateRight: false,\n        jump: false\n    }\n});\n\nexport const createGameData = (heightMap:HeightMap, playerDefs:Array<PlayerDef>):GameData => {\n    \n    let players:Array<Player> = playerDefs.map(def => {\n        let p = createPlayer();\n        p.accentColor = def.accentColor;\n        return p;\n    });\n\n    return {\n        isGameOver: false,\n        elapsedTime: 0,\n        heightMap,\n        players: players,\n        camFocus: {x:0, y:0}\n    };\n};\n\nconst createLayerDefinition = (id:string, scale:number):LayerDefinition => ({\n    id,\n    scale\n});\n\nexport const  createLayers = () => {\n    let layers:Array<LayerDefinition> = [\n        createLayerDefinition(\"background-layer\", 0.3),\n        createLayerDefinition(\"player-layer\", 1),\n        createLayerDefinition(\"foreground-layer\", 1.2)\n    ];\n    return layers;\n};\n\nexport interface HeightMap {\n    setAll: (callback:NumCallback) => void,\n    get: (index:number) => number,\n    count: () => number\n    clone: () => HeightMap,\n    bounds: () => {x:number, y:number, width:number, height:number},\n    smoothEnabled: (enable?:boolean) => void | boolean,\n    serialize: () => string\n};\n\nexport interface Point {\n    x:number,\n    y:number\n}\n\nexport const createSounds = (catalog?:SoundCatalog) => {\n    function selectPlayer() {\n        catalog.pickninja1.play();\n    }\n\n    function startGame() {\n        catalog.pickninja0.play();\n    }\n\n    function gameover() {\n        catalog.gameover.play();\n    }\n\n    function jump() {\n        catalog.jump.play();\n    }\n    \n    function land() {\n        catalog.land.play();\n    }\n    \n    function collide() {\n        catalog.collide.volume(0.6);\n        catalog.collide.play();\n    }\n\n    function roundover() {\n        catalog.roundover.play();\n    }\n\n    return {\n        selectPlayer,\n        startGame,\n        gameover,\n        roundover,\n        jump,\n        collide,\n        land\n    }\n};\n\nexport type Sound = ReturnType<typeof createSounds>;\n\nexport const defineResources = (levelname:string) => {\n    return {\n        levelSvg: \"levels/\" + levelname + \".svg\",\n        player1Svg: \"player-1.svg\",\n        player2Svg: \"player-2.svg\",\n        player3Svg: \"player-3.svg\",\n        player4Svg: \"player-4.svg\",\n        levelJson: \"levels/\" + levelname + \".json\",\n        music: \"music.mp3\",\n        collide: \"collide.mp3\",\n        gameover: \"gameover.mp3\",\n        jump: \"jump.mp3\",\n        land: \"land.mp3\",\n        pickninja0: \"pickninja0.mp3\",\n        pickninja1: \"pickninja1.mp3\",\n        roundover: \"roundover.mp3\",\n        sounds: createSounds()\n    };\n}\n\nexport interface SoundCatalog {\n    music: Howl,\n    collide: Howl,\n    gameover: Howl,\n    jump: Howl,\n    land: Howl,\n    pickninja0: Howl,\n    pickninja1: Howl,\n    roundover: Howl\n}\n\nexport const playerSvgs = (resources:Resources) => [\n    resources.player1Svg,\n    resources.player2Svg,\n    resources.player3Svg,\n    resources.player4Svg\n]\n\nexport type Resources = ReturnType<typeof defineResources>;\n\nexport interface PointCallback {\n    (p:Point): void\n}\n\nexport interface KeyboardMap {\n    left:number,\n    right:number,\n    up:number\n};\n\nexport interface GameData {\n    isGameOver: boolean,\n    elapsedTime: 0,\n    heightMap: HeightMap,\n    players: Array<Player>,\n    camFocus: Point\n}\n\nexport interface LayerDefinition {\n    id: string,\n    scale: number\n}","import { GameData, Point, GRAVITY, PLAYER_HEIGHT, Player, HeightMap, PLAYER_WIDTH, VIEWPORT_WIDTH, Resources } from \"./defs\";\nimport { isStillInTheGame, timeSinceOnlyOnPlayerStillInTheGame, playersSortByRoundWinner } from \"./util\";\nimport { resetPlayersOnGround } from \"./heightmap\";\n\nconst vecToCenter = (player:Player) => {\n    return scale(p(-Math.sin(player.angle), -Math.cos(player.angle)), PLAYER_HEIGHT/2);\n};\n\nconst getAngularAcceleration = (player:Player) => {\n    let input = player.input;\n    if (player.touchesGround) {\n        return 0;\n    }\n    if (input.rotateRight) {\n        return -1;\n    }\n    if (input.rotateLeft) {\n        return 1;\n    }\n    return -Math.sign(player.angleVel);\n};\n\nconst stepPlayerState = (dt:number, player:Player, heightMap:HeightMap, resources:Resources) => {\n\n    let pos = player.pos;\n    let vel = player.vel;\n    const input = player.input;\n    \n    // step physics\n    vel.y += GRAVITY * dt/1000;    \n    pos = add(pos, scale(vel, dt/1000));\n\n    // env\n    const delta = 1;\n    const slope = (heightMap.get(pos.x + delta/2) - heightMap.get(pos.x - delta/2))/delta;\n    const groundNormal = p(slope, -delta);\n    const groundTangentUnit = norm(p(delta, slope));\n    const tangentAngle = -Math.atan(slope/delta);\n    const throughGround = pos.y - heightMap.get(pos.x);\n    \n    // collide ground\n    if (throughGround >= 0) {\n        player.hasJumped = false;\n        pos.y -= throughGround;\n                \n        let velDotGroundNormal = dot(vel, groundNormal);\n        let movingTowardsGround = velDotGroundNormal < 0;\n        \n        if (movingTowardsGround) {        \n            // Tangentize velocity\n            let newVel = scale(groundTangentUnit, dot(vel, groundTangentUnit));\n            vel.x = newVel.x;\n            vel.y = newVel.y;\n        }\n\n        if (input.jump) {\n            resources.sounds.jump();\n            player.hasJumped = true;\n            let jumpVec = scale(norm(groundNormal), 5);\n            let slowDownVec = scale(groundTangentUnit, -1/4);\n            vel = add(vel, add(jumpVec, slowDownVec));            \n        } else {\n            // Tangentize angle when not jumping\n            let W = 5;\n            player.angle = 1/W * tangentAngle + (W-1)/W * player.angle;\n            player.angleVel = 0;\n        }\n    } else {\n        // air time!\n        if (player.hasJumped) {\n            let targetAngle = input.rotateLeft ? Math.PI/6 :\n            input.rotateRight ? -Math.PI/6 :\n            0;\n            \n            player.angleVel = 10*(targetAngle - player.angle);\n            \n            let angleDiff = player.angleVel * dt/1000;\n            let toCenterBeforeAngleChange = vecToCenter(player);\n            player.angle += angleDiff;\n            let toCenterAfterAngleChange = vecToCenter(player);\n        \n            pos = add(pos, sub(toCenterBeforeAngleChange, toCenterAfterAngleChange));\n        }\n    }\n    \n    acceleratePlayerRightLeft(player, throughGround, groundTangentUnit, dt);\n\n    player.touchesGround = throughGround >= 0;\n    player.pos = pos;\n    player.vel = vel;\n};\n\nconst acceleratePlayerRightLeft = (player:Player, throughGround:number, groundTangentUnit:Point, dt:number) => {\n\n    // 0 -> go right\n    // 1 -> go tangent\n    let W = Math.max(-1, Math.min(0, throughGround)) + 1;\n\n    let direction = add(scale(groundTangentUnit, W),\n                        scale(p(1, 0), (1 - W)));\n\n    let maxThrottle = 10;\n    let arrowAcc = 10;\n    if (player.input.rotateRight) {\n        player.vel.x += Math.max(0, Math.sign(maxThrottle - player.vel.x)) * direction.x * arrowAcc*dt/1000;\n        player.vel.y += Math.max(0, Math.sign(maxThrottle - player.vel.y)) * direction.y * arrowAcc*dt/1000;\n    }\n    if (player.input.rotateLeft) {\n        player.vel.x -= Math.max(0, Math.sign(maxThrottle + player.vel.x)) * direction.x * arrowAcc*dt/1000;\n        player.vel.y -= Math.max(0, Math.sign(maxThrottle + player.vel.y)) * direction.y * arrowAcc*dt/1000;\n    }\n};\n\nconst stepPlayerState_orig = (dt:number, player:Player, heightMap:HeightMap) => {\n\n    let angleAcc = getAngularAcceleration(player);\n    player.angleVel += 20*angleAcc * dt/1000;\n    player.angleVel = Math.max(-10, Math.min(10, player.angleVel));\n\n    let angleDiff = player.angleVel * dt/1000;\n    let toCenterBeforeAngleChange = vecToCenter(player);\n    player.angle += angleDiff;\n    let toCenterAfterAngleChange = vecToCenter(player);\n\n    player.pos = add(player.pos, sub(toCenterBeforeAngleChange, toCenterAfterAngleChange));\n    \n    let pos = player.pos;\n    let vel = player.vel;\n    \n    vel.y += GRAVITY * dt/1000;\n    \n    pos.x += vel.x * dt/1000;\n    pos.y += vel.y * dt/1000;\n    \n    let delta = 1;\n    let slope = (heightMap.get(pos.x + delta/2) - heightMap.get(pos.x - delta/2))/delta;\n    let groundNormal = p(slope, -delta);\n        \n    const posCenter = add(pos, toCenterAfterAngleChange);\n    const centerThroughGround = posCenter.y - heightMap.get(posCenter.y);\n    const throughGround = pos.y - heightMap.get(pos.x);\n\n    if (throughGround >= 0) {\n        pos.y -= throughGround;\n        \n        let groundTangentUnit = norm(p(delta, slope));\n        let movingTowardsGround = dot(vel, groundNormal) < 0;\n        \n        let flip360Forward = false;\n        let tangentAngle = -Math.atan(slope/delta);\n\n        if (movingTowardsGround) {\n            // Tangentize velocity\n            let newVel = scale(groundTangentUnit, dot(vel, groundTangentUnit));\n            vel.x = newVel.x;\n            vel.y = newVel.y;\n\n            let airTimeRevolutions = Math.round((player.angle - tangentAngle) / (2*Math.PI));\n            flip360Forward = airTimeRevolutions === -1;\n            player.angle += -airTimeRevolutions * 2*Math.PI;\n        }\n\n        if (player.input.jump) {\n            let jumpVec = scale(norm(groundNormal), 5);\n            let slowDownVec = scale(groundTangentUnit, -1/4);\n            player.vel = add(player.vel, add(jumpVec, slowDownVec));            \n        } else {\n            // Tangentize angle when not jumping\n            let W = 5;\n            player.angle = 1/W * tangentAngle + (W-1)/W * player.angle;\n            player.angleVel = 0;\n        }\n\n        if (player.input.rotateRight) {\n            player.vel = add(player.vel, p(2*dt/1000, 0));\n        }\n        if (player.input.rotateLeft) {\n            player.vel = add(player.vel, p(-2*dt/1000, 0));\n        }\n    }\n    \n    player.touchesGround = throughGround >= 0;\n};\n\nconst proj = (vec:Point, onVec:Point) => scale(onVec, dot(vec, onVec));\n\nexport const reflect = (vec: Point, normal:Point) => {\n    let tangent = p(-normal.y, normal.x);\n    let vecProjTangent = proj(vec, tangent);\n    let vecProjNormal = proj(vec, normal);\n    let result = add(vecProjTangent, scale(vecProjNormal, -1));\n    return result;\n};\n\nexport const collidePlayerPair = (p1:Player, p2:Player, resources:Resources) => {\n    let diff = sub(p2.pos, p1.pos);\n    let dist = magnitude(diff);\n    if (dist < PLAYER_WIDTH * 0.7) {\n        let velDiff = sub(p1.vel, p2.vel);\n        if (dot(velDiff, diff) > 0) {\n            // collision!\n            resources.sounds.collide();\n            let normDiff = scale(diff, 1/dist);\n            p1.vel = add(p1.vel, reflect(velDiff, normDiff));\n            p2.vel = sub(p2.vel, reflect(velDiff, normDiff));\n        }\n    }\n};\n\nconst collidePlayers = (players:Array<Player>, resources:Resources) => {\n    let numPlayers = players.length;\n    players.forEach((p1, p1i) => {\n        for (let p2i = p1i + 1; p2i < numPlayers; p2i++) {\n            let p2 = players[p2i];\n            collidePlayerPair(p1, p2, resources);\n        }\n    });\n};\n\nconst calcCamFocus = (player:Player, gameData:GameData) => {\n    \n    let playerCenter = add(player.pos, vecToCenter(player));\n    let currentFocus = gameData.camFocus;\n\n    let W = 5 + Math.pow(2, 10*(timeSinceOnlyOnPlayerStillInTheGame(gameData) / 1000));\n\n    return add(scale(playerCenter, 1/W),\n               scale(currentFocus, (W-1)/W));\n};\n\nconst calcPlayerLead = (players:Array<Player>) => {\n    let lead = players[0];\n    players.forEach(p => {\n        if (p.pos.x > lead.pos.x) {\n            lead = p;\n        }\n    });\n    return lead;\n};\n\nexport const stepState = (dt:number, gameData:GameData, resources:Resources) => {\n    gameData.elapsedTime += dt;\n\n    let remainingPlayers = gameData.players.filter(isStillInTheGame);\n\n    remainingPlayers.forEach(p => stepPlayerState(dt, p, gameData.heightMap, resources));\n\n    collidePlayers(remainingPlayers, resources);\n    \n    let playerLead = calcPlayerLead(remainingPlayers);\n\n    gameData.camFocus = calcCamFocus(playerLead, gameData);\n\n    let f = gameData.camFocus;\n    remainingPlayers.forEach(p => {\n        if (p.accentColor === playerLead.accentColor) {\n            return;\n        }\n\n        if (p.pos.x < f.x - 0.9*VIEWPORT_WIDTH/2 ||\n            p.pos.y > f.y + 0.9*VIEWPORT_WIDTH/2) {\n                p.droppedOutTime = gameData.elapsedTime;\n\n                if (remainingPlayers.length == 2) {\n                    // We have a winner\n                    let playersCopy = playersSortByRoundWinner(gameData.players);\n                    playersCopy.forEach((p, i) => {\n                        p.score = p.score + playersCopy.length - i - 1;\n                        if (p.score >= 10) {\n                            gameData.isGameOver = true;\n                        } \n                    });\n\n                    if (gameData.isGameOver) {\n                        resources.sounds.gameover();\n                    } else {\n                        resources.sounds.roundover();\n                    }\n                }\n            }\n    });\n\n    if (remainingPlayers.length === 1) {\n        if (timeSinceOnlyOnPlayerStillInTheGame(gameData) > 3000) {\n            // Round is done, scores have been shown!\n            \n            if (!gameData.isGameOver) {\n                resetPlayersOnGround(gameData.players, gameData.heightMap, gameData.camFocus.x);\n            }\n        }\n    }\n};\n\nconst magnitude = (vec:Point) => {\n    return Math.sqrt(vec.x*vec.x + vec.y*vec.y);\n};\n\nconst add = (vec1:Point, vec2:Point) => p(vec1.x + vec2.x, vec1.y + vec2.y);\n\nconst sub = (vec1:Point, vec2:Point) => p(vec1.x - vec2.x, vec1.y - vec2.y);\n\nconst dot = (vec1:Point, vec2:Point) => vec1.x * vec2.x + vec1.y * vec2.y;\n\nconst scale = (vec:Point, scalar:number) => p(vec.x * scalar, vec.y * scalar);\n\nconst norm = (vec:Point) => scale(vec, 1/magnitude(vec));\n\nexport const p = (x:number, y:number) => ({x, y});","import { HeightMap, Player, PLAYER_WIDTH } from \"./defs\";\nimport { p } from \"./physics\";\n\nexport const resetPlayersOnGround = (players:Array<Player>, heightMap:HeightMap, offsetX:number) => {\n    let list = [...players].sort((p1, p2) => p2.score - p1.score);\n    list.forEach((player, i) => {\n        player.vel = p(0, 0);\n        player.pos.x = offsetX + i*PLAYER_WIDTH*1.3;\n        player.pos.y = heightMap.get(player.pos.x);\n        player.droppedOutTime = -1;\n    });\n};\n\nexport const createHeightMap = (size:number) : HeightMap => {\n    \n    let maxValue:number = 0;\n    let minValue:number = 0;\n    let heightMap = new Array(size);\n    let smooth:any;\n    let smoothEnabled_ = false;\n    \n    for (let i = 0; i < size; i++) {\n        heightMap[i] = 0;\n    }\n\n    const get = (x:number) => {\n        x = Math.max(0, Math.min(heightMap.length-1, x));\n        if (smoothEnabled_) {\n            return getSmoothValue(x);\n        }\n        else {\n            let floor = Math.floor(x);\n            if (floor === x) {\n                return heightMap[x];\n            }\n            \n            let fraq = x - floor;\n            return (1-fraq)*heightMap[floor] + (fraq)*heightMap[floor+1];\n        }\n    };\n\n    const getSmoothValue = (x:number) => smooth(x);\n\n    const setAll = (valueFromIndex:(index:number) => number) => {\n        minValue = 10e9;\n        maxValue = -10e9;\n        for (let i = 0; i < size; i++) {\n            let val = valueFromIndex(i);\n            minValue = Math.min(minValue, val);\n            maxValue = Math.max(maxValue, val);\n            heightMap[i] = val;\n        }\n        // @ts-ignore\n        smooth = window.Smooth(heightMap);\n    };\n\n    const length = () => heightMap.length;\n\n    const clone = () => {\n        let copy = createHeightMap(size);\n        copy.setAll((i:number) => get(i));\n        copy.smoothEnabled(smoothEnabled_);\n        return copy;\n    };\n\n    const bounds = () => {\n        return {\n            x:0,\n            y:minValue,\n            width: heightMap.length,\n            height:maxValue - minValue \n        };\n    };\n\n    const smoothEnabled = (enable?:boolean) => {\n        if (enable === undefined) {\n            return smoothEnabled_;\n        }\n        smoothEnabled_ = enable;\n    };\n\n    const serialize = () => {\n        return JSON.stringify(heightMap);\n    };\n\n    return {\n        setAll,\n        get,\n        count: length,\n        clone,\n        bounds,\n        smoothEnabled: smoothEnabled,\n        serialize\n    };\n};\n","import { Point, HeightMap, Player, GameData } from \"./defs\";\nimport { createHeightMap } from \"./heightmap\";\n\nexport const isCloseToPath = (p:Point, heights:HeightMap, tolerance:number) => {\n    let ix = Math.round(p.x);\n    if (ix < -tolerance || ix > heights.count() + tolerance) {\n        return false;\n    }\n    return Math.abs(heights.get(p.x) - p.y) < tolerance;\n};\n\nexport const loadLevelJson = async (levelName:string) => {\n    let response = await fetch(levelName);\n    let json = await response.json();\n    let heightMap = createHeightMap(json.length);\n    heightMap.setAll((i:number) => json[i]);\n    return heightMap;\n};\n\nlet svgCache = {};\n\nexport const loadSvg = async function(svgUrl:string) {\n    let cachedText = svgCache[svgUrl];\n\n    if (!cachedText) {\n        let response = await fetch(svgUrl);\n        cachedText = await response.text();    \n    }\n\n    return {\n        asElement\n    };\n\n    function asElement() {\n\t    const parser = new DOMParser();\n        const parsed = parser.parseFromString(cachedText, 'image/svg+xml');\n        return parsed.getElementsByTagName(\"svg\")[0];\n    };\n};\n\nexport const isStillInTheGame = (player:Player) => {\n    return player.droppedOutTime < 0;\n};\n\nexport const timeSinceOnlyOnPlayerStillInTheGame = (gameData:GameData) => {\n    let playersStillInTheGame = 0;\n    let timeForLastPlayerDroppedOut = 0; \n    let elapsedTime = gameData.elapsedTime;\n    if (elapsedTime < 2000) {\n        return 0;\n    }\n\n    if (gameData.players.length === 1) {\n        return 0;\n    }\n\n    gameData.players.forEach(p => {\n        let droppedOutTime = p.droppedOutTime;\n        if (droppedOutTime < 0) {\n            playersStillInTheGame++;\n        } else {\n            timeForLastPlayerDroppedOut = Math.max(timeForLastPlayerDroppedOut, droppedOutTime);\n        }\n    });\n\n    return playersStillInTheGame === 1 ? (elapsedTime - timeForLastPlayerDroppedOut) : 0\n};\n\nexport const playersSortByRoundWinner = (players:Array<Player>) => {\n    let playersCopy = [...players].sort((p1, p2) =>  p2.droppedOutTime - p1.droppedOutTime);\n    let winner = playersCopy.pop();\n    return [winner].concat(playersCopy);\n};","import { Point, PointCallback} from \"./defs\";\nimport SVG from \"svgjs\";\n\ninterface DragOperationSettings {\n    onMouseMove: PointCallback,\n    onMouseUp: () => void\n};\n\nexport function MouseInput(mainSvg:any) {\n    const helperPoint = mainSvg.createSVGPoint();\n    const s = SVG(mainSvg);\n    let internalMouseDownCallback:any;\n\n    const event2domPoint = (e:MouseEvent) : Point => ({x:e.pageX, y:e.pageY});\n\n    const createDeviceMapper = () => {\n        let Q = 100;\n        let anyPoint = {x:0, y:0};\n        let startPoint = domPoint2svgPoint(anyPoint);\n        let startPointQ = domPoint2svgPoint({x:anyPoint.x + Q, y:anyPoint.y + Q});\n\n        return (domPoint:Point) => {\n            return {\n                x: startPoint.x + (startPointQ.x - startPoint.x)*(domPoint.x - anyPoint.x)/Q,\n                y: startPoint.y + (startPointQ.y - startPoint.y)*(domPoint.y - anyPoint.y)/Q\n            };\n        };\n    };\n\n    const domPoint2svgPoint = (domPoint:Point) : Point => {\n        helperPoint.x = domPoint.x;\n        helperPoint.y = domPoint.y;\n        return helperPoint.matrixTransform(mainSvg.getScreenCTM().inverse());\n    };\n\n    const onMouseDown = (callback:PointCallback) => {\n        if (!!internalMouseDownCallback) {\n            throw \"double trouble callback. (Registered twice)\";\n        }\n\n        internalMouseDownCallback = (e:MouseEvent) => {\n            let svgPoint = domPoint2svgPoint(event2domPoint(e));\n            callback(svgPoint);\n        };\n        s.on(\"mousedown\", internalMouseDownCallback);\n    };\n\n    const startDragOperation = (settings:DragOperationSettings) => {\n        let deviceMapper = createDeviceMapper();\n\n        const mouseMove = (e:MouseEvent) => {\n            settings.onMouseMove(deviceMapper(event2domPoint(e)));\n        };\n\n        const mouseUp = () => {\n            window.removeEventListener(\"mousemove\", mouseMove, true);\n            window.removeEventListener(\"mouseup\", mouseUp, true);\n            settings.onMouseUp();\n        };\n\n        window.addEventListener(\"mousemove\", mouseMove, true);\n        window.addEventListener(\"mouseup\", mouseUp, true);    \n    };\n\n    const off = () => {\n        s.off(\"mousedown\", internalMouseDownCallback);\n        internalMouseDownCallback = null;\n    };\n\n    return {\n        onMouseDown,\n        startDragOperation,\n        off\n    };\n};","import { Player, KeyboardMap, PlayerDef } from \"./defs\";\n\ntype KeyboardInput = ReturnType<typeof createKeyboardInput>;\n\nexport const bindPlayerKeyboardInput = (players:Array<Player>, playerDefs:Array<PlayerDef>, keyboardInput:KeyboardInput) => {\n    players.forEach((player, i) => {\n        let keyMap = playerDefs[i].keyMap;\n        keyboardInput.onKeyDown(keyMap.right, () => { player.input.rotateRight = true; });\n        keyboardInput.onKeyUp(keyMap.right, () => { player.input.rotateRight = false; });\n        keyboardInput.onKeyDown(keyMap.left, () => { player.input.rotateLeft = true; });\n        keyboardInput.onKeyUp(keyMap.left, () => { player.input.rotateLeft = false; });\n        keyboardInput.onKeyDown(keyMap.up, () => { player.input.jump = true; });\n        keyboardInput.onKeyUp(keyMap.up, () => { player.input.jump = false; });\n    });\n};\n\nexport function createKeyboardInput() {\n    \n    let addedHandlers = Array<any>();\n\n    const onKeyDown = (keyCode:number, callback:()=>void) => {\n\n        let handler = (e:KeyboardEvent) => {\n            if (e.keyCode === keyCode) {\n                callback();\n            }\n        };\n\n        add(\"keydown\", handler);\n    };\n\n    const onKeyUp = (keyCode:number, callback:()=>void) => {\n\n        let handler = (e:KeyboardEvent) => {\n            if (e.keyCode === keyCode) {\n                callback();\n            }\n        };\n\n        add(\"keyup\", handler);\n    };\n\n    const add = (eventName:string, handler:any) => {\n        addedHandlers.push([eventName, handler]);\n        window.addEventListener(eventName, handler);\n    };\n\n    const off = () => {\n        let kvp = addedHandlers.pop();\n        while (!!kvp) {\n            window.removeEventListener(kvp[0], kvp[1]);\n            kvp = addedHandlers.pop();\n        }\n    };\n\n    return {\n        onKeyDown,\n        onKeyUp,\n        off\n    };\n};","import SVG from \"svgjs\";\nimport { PathDrawer } from \"./editor-graphics\";\nimport { isCloseToPath } from \"./util\";\nimport { Point, GameData } from \"./defs\";\nimport { ViewPort } from \"./viewport\";\nimport { MouseInput } from \"./mouseinput\";\nimport { createKeyboardInput } from \"./keyboardinput\";\n\nconst decayedWeight = (zoomLevel:number) => (distFromFocus:number) => {\n    let adjustedDist = distFromFocus / zoomLevel;\n    return Math.pow(1.05, -adjustedDist*adjustedDist);\n};\n\n\nconst download = (filename:string, dataType:string, contents:string) => {\n    dataType = dataType || \"text/plain;charset=utf-8\";\n    var pom = document.createElement('a');\n    pom.setAttribute('href', 'data:' + dataType + ',' + encodeURIComponent(contents));\n    pom.setAttribute('download', filename);\n\n    if (document.createEvent) {\n        var event = document.createEvent('MouseEvents');\n        event.initEvent('click', true, true);\n        pom.dispatchEvent(event);\n    }\n    else {\n        pom.click();\n    }\n}\n\nexport const Editor = (gamedata:GameData, viewPort:ViewPort, pathDrawer:PathDrawer) => {\n\n    let editorVisible = true;\n    let heightMap = gamedata.heightMap;\n    let mainSvg:HTMLElement = document.getElementById(\"mainsvg\");\n    let s = SVG(mainSvg);\n\n    let mouseInput = MouseInput(mainSvg);\n    let keyboardInput = createKeyboardInput();\n\n    const startChangeHeights = (pDown:Point) => {\n        heightMap.smoothEnabled(false);\n\n        let heightMapCopy = heightMap.clone();\n        let calcWeight = decayedWeight(viewPort.zoomLevel());\n        \n        mouseInput.startDragOperation({\n            onMouseMove: (pMove:Point) => {\n                let yDiff = pMove.y - pDown.y;\n                heightMap.setAll((ix:number) => heightMapCopy.get(ix) + yDiff * calcWeight(ix - pDown.x));\n                pathDrawer.drawAllLayers();\n                viewPort.adjustLayerPerspectives(viewPort.location());\n                //updateHeightDots(editGroup, heightMap);\n            },\n            onMouseUp: () => {\n                s.select(\".dot\").each((i, m) => m[i].remove());\n                heightMap.smoothEnabled(true);\n                pathDrawer.drawAllLayers();\n            }\n        });\n    };\n\n    const startPanning = (pDown:Point) => {\n        let location = viewPort.location();\n        mouseInput.startDragOperation({\n            onMouseMove: (pMove:Point) => {\n                viewPort.location({\n                    x:location.x - (pMove.x - pDown.x),\n                    y:location.y - (pMove.y - pDown.y)\n                });\n            },\n            onMouseUp: () => {}\n        });\n    };\n\n    const onMouseDown = (pDown:Point) => {\n        let tolerance = viewPort.zoomLevel()/2;\n        if (isCloseToPath(pDown, heightMap, tolerance))\n        {\n           startChangeHeights(pDown);\n        }\n        else\n        {\n            startPanning(pDown);\n        }\n    };\n\n    const onWheel = (e:WheelEvent) => {\n        viewPort.zoom(e.deltaY > 0 ? 1/1.1 : 1.1)\n    };\n\n    const downloadHeightMap = () => {\n        download(\"level.json\", \"application/json\", heightMap.serialize());\n    };\n\n    const downloadSvg = () => {\n        let currentLocation = viewPort.location();\n        viewPort.resetLayerPerspectives();\n        \n        download(\"level.svg\", \"image/svg+xml\", pathDrawer.serialize());\n        \n        viewPort.location(currentLocation);\n        viewPort.adjustLayerPerspectives(currentLocation);        \n    };\n\n    const show = () => {\n        keyboardInput.onKeyDown(49, downloadHeightMap); // key \"1\"\n        keyboardInput.onKeyDown(50, downloadSvg); // key \"2\"\n        pathDrawer.drawAllLayers();\n        mouseInput.onMouseDown(onMouseDown);\n        window.addEventListener(\"wheel\", onWheel);\n        editorVisible = true;\n        //editGroup.show();\n    };\n\n    const hide = () => {\n        mouseInput.off();\n        keyboardInput.off();\n        window.removeEventListener(\"wheel\", onWheel);\n        editorVisible = false;\n        //editGroup.hide();\n    };\n\n    const toggle = (visible?:boolean) => {\n        if (visible !== undefined) {\n            visible ? show() : hide();\n        }\n        else {\n            editorVisible ? hide() : show();\n        }\n        return editorVisible;\n    };\n\n    const getHeightMap = () => {\n        return heightMap.clone();\n    }\n\n    return {\n        toggle,\n        getHeightMap\n    };\n};\n","import { createKeyboardInput } from \"./keyboardinput\";\nimport { GameData, Resources } from \"./defs\";\n\nexport const GameLoop = (updateGameState:(dt:number, gameData:GameData, resources:Resources)=>void ,updateGameView:(gameData:GameData)=>void, resources:Resources) => {\n\n    const keyboard = createKeyboardInput();\n    const TIME_STEP = 10; \n    let gameData:GameData;\n    let animationFrameTimeout:any = null;\n    let previousTime:number = -1;\n\n    const onFrame = () => {\n        let now = Date.now();\n        while (previousTime + TIME_STEP < now) {\n            previousTime += TIME_STEP;\n            updateGameState(TIME_STEP, gameData, resources);\n        }\n\n        updateGameView(gameData);\n        animationFrameTimeout = window.requestAnimationFrame(onFrame);\n    };\n\n    const start = (g:GameData) => {\n        gameData = g;\n        previousTime = Date.now();\n        onFrame();\n    };\n\n    const stop = () => {\n        keyboard.off();\n        if (!!animationFrameTimeout) {\n            window.cancelAnimationFrame(animationFrameTimeout);\n            animationFrameTimeout = null;\n        }\n    };\n\n    return {\n        start,\n        stop\n    };\n};","import SVG from \"svgjs\";\nimport { Point, LayerDefinition, HeightMap, VIEWPORT_WIDTH } from \"./defs\";\n\nexport type ViewPort = ReturnType<typeof createViewPort>;\n\nexport const createViewPort = (s:SVG.Doc, layers:Array<LayerDefinition>) => {\n    \n    let zoomLevel = 1;\n\n    s.viewbox({\n        x: -VIEWPORT_WIDTH / 2,\n        y: -VIEWPORT_WIDTH / 2,\n        width: VIEWPORT_WIDTH,\n        height: VIEWPORT_WIDTH\n    });\n\n    const zoom = (factor:number) => {\n        let v = s.viewbox();\n        zoomLevel *= factor;\n        let newWidth = zoomLevel * VIEWPORT_WIDTH;\n\n        s.viewbox({\n            x:v.x + (v.width - newWidth)/2,\n            y:v.y + (v.width - newWidth)/2,\n            width: newWidth,\n            height: newWidth\n        });\n    };\n\n    const adjustLayerPerspectives = (p:Point) => {\n        layers.forEach(layer => {\n            let layerSvg = s.select(\"#\" + layer.id).get(0);\n            layerSvg.scale(layer.scale, layer.scale, 0, 0);\n            layerSvg.translate(p.x*(1-layer.scale), p.y*(1-layer.scale));\n        });\n    };\n\n    const resetLayerPerspectives = () => {\n        layers.forEach(layer => {\n            let layerSvg = s.select(\"#\" + layer.id).get(0);\n            layerSvg.matrix(1, 0, 0, 1, 0, 0);\n        });\n    };\n\n    const location = (p?:Point) => {\n        let v = s.viewbox();\n        if (!!p) {\n            s.viewbox({\n                x: p.x - v.width/2,\n                y: p.y - v.height/2, \n                width: v.width, \n                height:v.height\n            });\n\n            adjustLayerPerspectives(p);\n        }\n        else\n        {\n            return {x:v.x + v.width/2, y:v.y + v.height/2};\n        }\n    }\n\n    const setGetZoomLevel = (level?:number) => {\n        if (level === undefined) {\n            return zoomLevel;\n        }\n        zoomLevel = level;\n        zoom(1);\n    };\n\n    const width = () => {\n        return s.viewbox().width;\n    };\n\n    return {\n        width,\n        zoom,\n        zoomLevel: setGetZoomLevel,\n        location,\n        adjustLayerPerspectives,\n        resetLayerPerspectives\n    };\n};","import SVG from \"svgjs\";\nimport { LayerDefinition, HeightMap, VIEWPORT_WIDTH } from \"./defs\";\n\nexport type PathDrawer = ReturnType<typeof createPathDrawer>;\n\nexport const createPathDrawer = (s:SVG.Doc, heights:HeightMap, layers:Array<LayerDefinition>) => {\n\n    layers.sort((a, b) => a.scale - b.scale);\n\n    const drawAllLayers = () => {\n        drawLayerWithScale((_) => true);\n    };\n\n    const drawLayerWithScale = (predicate:(scale:number) => boolean) => {\n        layers.forEach(def => {\n            if (predicate(def.scale)) {\n                let group = getEditGroup(s, def.id, def.scale);\n                drawHeightPath(group, heights, def.scale);\n            }\n        });\n    };\n\n    const serialize = () => {\n        // @ts-ignore\n        return s.svg();\n    };\n\n    return {\n        drawAllLayers,\n        drawLayerWithScale,\n        serialize\n    };\n};\n\nconst getEditGroup = (s:SVG.Doc, id:string, scale:number):SVG.G => {\n    let editGroup = s.select(\"#\" + id).get(0) as SVG.G;\n    if (editGroup == null) {\n        editGroup = s.group().id(id).opacity(scale === 1 ? 1 : 0.3);\n    }\n    return editGroup;\n};\n\nconst drawHeightPath = (editGroup:SVG.G, heights:HeightMap, scale:number) => {\n    let path = editGroup.select(\".heightPaths\").get(0);\n    if (path) {\n        path.remove();\n    }\n\n    let multiplier = Math.min(scale, 1) * (heights.smoothEnabled() ? 5 : 1);\n    let maxDepth = -10000;\n    let points = heights.count() * multiplier;\n    \n    let parts = heights.count() / VIEWPORT_WIDTH;\n    let partList = [];\n\n    for (let partIx = 0; partIx < parts; partIx++) {\n\n        let startIx = Math.floor(points * partIx / parts);\n        let endIx = Math.min(Math.floor(points * (partIx + 1) / parts), points);\n\n        let part = new Array(endIx - startIx);\n        // \"<=\" constraint for overlapping parts\n        for (let ix = startIx; ix <= endIx; ix++) {            \n            let x = ix / multiplier;\n            let h = heights.get(x);\n            maxDepth = Math.max(maxDepth, h);\n            part[ix - startIx] = [x, h];\n        }\n        partList.push(part);\n    }\n\n    let polylines = editGroup.group().addClass(\"heightPaths\");\n\n    partList.forEach(part => {\n        // Close the path for each part\n        const slightoverlap = 1;\n        part.push([part[part.length-1][0] + slightoverlap, maxDepth+1]);\n        part.push([part[0][0], maxDepth+1]);\n        part.push([part[0][0], part[0][1]]);\n\n        polylines.group().polyline(part)// .stroke({width: 0.1, color:\"#aa6666\"})\n        .fill(\"#ffaaaa\");    \n    });    \n};","import { Point, LayerDefinition } from \"./defs\";\nimport SVG from \"svgjs\";\n\nexport interface Partition {\n    left: number,\n    right: number\n};\n\nexport const getPartitionLeftRight = (canvasWidth:number) => (canvasLeft:number, canvasRight:number, scale:number) => {\n\n    canvasLeft -= canvasWidth / 2;\n    canvasRight -= canvasWidth / 2;\n\n    let partitionLeft = Math.floor(canvasLeft / canvasWidth / scale) - Math.ceil(1 / scale);\n    let partitionRight = Math.floor(canvasRight / canvasWidth / scale) + Math.ceil(1 / scale);\n\n    return {\n        left: partitionLeft,\n        right: partitionRight\n    };\n};\n\nexport const setupPartitions = (canvasWidth:number, viewPortWidth:number, layers:Array<LayerDefinition>, s:SVG.Doc) => {\n    \n    let partitionTransitions:{[key:string]:Array<()=>void>} = {};\n    //let svgLevelWidth = heightMap.count();\n    let partitionSvgWidth = viewPortWidth;\n\n    const partitionKey = (from:number, to:number) => from + \"->\" + to;\n\n    const addPartitionTransition = (from:number, to:number, showHideAction:() => void) => {\n        let key = partitionKey(from, to);\n        let transition = partitionTransitions[key];\n        if (transition === undefined) {\n            transition = [];\n            partitionTransitions[key] = transition;\n        }\n        transition.push(showHideAction);\n    }\n\n    const svgPointToPartitionNum = (p:Point) => {\n        return Math.floor(p.x / partitionSvgWidth);\n    };\n\n    const applyTransitionUsingPartitions = (pFrom:number, pTo:number) => {\n        if (pFrom !== pTo) {\n            let transition = partitionTransitions[partitionKey(pFrom, pTo)];\n            if (!!transition) {\n                transition.forEach(action => action());\n            }\n        }\n    };\n\n    const applyTransition = (svgFromPoint:Point, svgToPoint:Point) => {\n        let partitionFrom = svgPointToPartitionNum(svgFromPoint); \n        let partitionTo = svgPointToPartitionNum(svgToPoint);\n        applyTransitionUsingPartitions(partitionFrom, partitionTo);\n    };\n\n    const showAction = (g:SVG.G) => () => g.show(); \n    const hideAction = (g:SVG.G) => () => g.hide(); \n  \n    const register = (g:SVG.G, canvasLeft:number, canvasRight:number, scale:number) => {\n        let { left, right } = getPartitionLeftRight(canvasWidth)(canvasLeft, canvasRight, scale)\n\n        addPartitionTransition(right, right + 1, hideAction(g));\n        addPartitionTransition(right + 1, right, showAction(g));\n        addPartitionTransition(left, left - 1, hideAction(g));\n        addPartitionTransition(left - 1, left, showAction(g));\n    };\n\n    // prepare culling\n    layers.forEach(layer => {\n        let layerSvg = s.select(\"#\" + layer.id).get(0) as SVG.G;\n        let all = layerSvg.select(\"g\");\n        for (let i = 0; i < all.length(); i++) {\n            let g = all.get(i) as SVG.G;\n            if (g.select(\"g\").length() === 0) {\n                // g has no child groups\n                let rect = g.node.getBoundingClientRect();\n                register(g, rect.left, rect.right, layer.scale);\n                g.hide();\n            }\n        }\n    });\n\n    // make initial transitions to make items visible from start\n    let t = -100;\n    while (t < 0) {\n        applyTransitionUsingPartitions(t, t+1);\n        t++;\n    }\n\n    return applyTransition;\n}","import { getPartitionLeftRight, Partition } from \"./partitioning\";\nimport { createVerify } from \"crypto\";\nimport { Point, Player, createPlayer } from \"./defs\";\nimport { reflect, p, collidePlayerPair } from \"./physics\";\n\nconst testPartitions = () => {\n\n    const verify = (message:string, partition:Partition, left:number, right:number) => {\n        if (partition.left !== left || partition.right !== right) {\n            console.log(message + \": \" + partition.left + \",\" + partition.right + \"  expected \" + left + \",\" + right);\n        }\n    };\n\n    let get = getPartitionLeftRight(500);\n    verify(\n        \"screen width, offset 0.5\", \n        get(250, 749, 1), -1, 1);\n    verify(\n        \"screen width*1.5, offset 0\", \n        get(0, 749, 1), -2, 1);\n    verify(\n        \"screen width*2, offset 1.5\", \n        get(750, 1750, 1), 0, 4);\n    verify(\n        \"screen width, offset 1.5\", \n        get(250 + 10*500, 250 + 11*500, 1), 9, 12);\n    // scale 0.5\n    verify(\n        \"screen width*10, offset 0, scale 0.5\", \n        get(250, 500*10, 0.5), -2, 21);\n        \n}\n\nconst testReflect = () => {\n    const verifyEqual = (p1: Point, p2:Point) => {\n        if (p1.x !== p2.x || p1.y !== p2.y) {\n            console.log(p1.x + \",\" + p1.y + \" not equal to \" + p2.x + \",\" + p2.y);\n        }\n    };\n\n    verifyEqual(p(-1, 0), reflect(p(1, 0), p(1, 0)));\n    verifyEqual(p(10, -10), reflect(p(10, 10), p(0, 1)));\n    verifyEqual(p(0, -10), reflect(p(10, 0), p(1/Math.sqrt(2), 1/Math.sqrt(2))));\n};\n\nconst testCollide = () => {\n    const verifyEqual = (p1: Point, p2:Point) => {\n        if (p1.x !== p2.x || p1.y !== p2.y) {\n            console.log(p1.x + \",\" + p1.y + \" not equal to \" + p2.x + \",\" + p2.y);\n        }\n    };\n\n    const makePlayer = (pos:Point, vel:Point) => {\n        let p = createPlayer();\n        p.pos = pos;\n        p.vel = vel;\n        return p;\n    };\n\n    let p1 = makePlayer(p(0, 0), p(1, 0));\n    let p2 = makePlayer(p(0.1, 0), p(0, 0));\n    //collidePlayerPair(p1, p2);\n    verifyEqual(p1.vel, p(0, 0));\n    verifyEqual(p2.vel, p(1, 0));\n};\n\nexport const test = () => {\n    testPartitions();\n    testReflect();\n    testCollide();\n};","import { ViewPort } from \"./viewport\";\nimport SVG from \"svgjs\";\nimport { LayerDefinition, Point, GameData, PLAYER_HEIGHT, Player, VIEWPORT_WIDTH, PLAYER_WIDTH, Resources, playerSvgs } from \"./defs\";\nimport { setupPartitions } from \"./partitioning\";\nimport { loadSvg, isStillInTheGame, timeSinceOnlyOnPlayerStillInTheGame } from \"./util\";\n\nconst showRoundResults = (s:SVG.Doc, viewPort:ViewPort, players:Array<Player>, isGameOver:boolean, resources:Resources) => {\n    let elem = s.select(\".roundResultsContainer\").get(0) as SVG.G;\n    if (!elem) {\n        elem = s.group().addClass(\"roundResultsContainer\");\n        \n        let innerElem = elem.group().addClass(isGameOver ? \"gameResults\" : \"roundResults\");\n        innerElem.group()\n            .rect(VIEWPORT_WIDTH*5, VIEWPORT_WIDTH*5)\n            .translate(-5*VIEWPORT_WIDTH/2, -5*VIEWPORT_WIDTH/2)\n            .opacity(0.8)\n            .fill(\"white\");\n        \n        // sort, make winner first\n        let circleSize = 0.5;\n        let rowHeight = PLAYER_HEIGHT * 1.5;\n        let leftAlign = -PLAYER_WIDTH - circleSize*10*1.25/2;\n        let topAlign = -rowHeight * players.length / 2 + PLAYER_HEIGHT / 2;\n\n        players.forEach((p, i) => {\n            let row = innerElem.group().translate(leftAlign, topAlign + i*rowHeight);\n            loadPlayerSvg(row.group().style(\"color\", p.accentColor), playerSvgs(resources)[i]);\n\n            let points = row.group();\n            for (var i = 0; i < 10; i++) {\n                let circleSize = 0.5;\n                let circle = points.circle(circleSize)\n                    .stroke({width:0.05, color: p.accentColor})\n                    .fill(\"transparent\")\n                    .translate(PLAYER_WIDTH + i*circleSize*1.25, -PLAYER_HEIGHT/2 - circleSize/2);\n                if (p.score > i) {\n                    circle.fill(p.accentColor);\n                }\n            }\n        });\n    }\n    \n    let location = viewPort.location();\n    elem.translate(location.x, location.y);\n\n};\n\nconst hideRoundResults = (s:SVG.Doc) => {\n    let elem = s.select(\".roundResultsContainer\").get(0) as SVG.G;\n    if (!!elem) {\n        elem.remove();\n    }\n};\n\nexport const createView = (viewPort:ViewPort, s:SVG.Doc, layers:Array<LayerDefinition>, resources:Resources) => {\n    \n    let playerSvgGroups: Array<SVG.G> = [];\n    let previousCamFocus:Point = {x:0, y:0};\n    let applyTransition:(from:Point, to:Point)=>void;\n\n    const update = (gameData:GameData) => {\n        viewPort.location(gameData.camFocus);\n        \n        if (timeSinceOnlyOnPlayerStillInTheGame(gameData) > 0 || gameData.isGameOver) {\n            showRoundResults(s, viewPort, gameData.players, gameData.isGameOver, resources);\n        } else {\n            hideRoundResults(s);\n        }\n        \n        gameData.players.forEach((player, i) => {\n            if (!isStillInTheGame(player)) {\n                return;\n            }\n\n            let playerPos = player.pos;\n            let g = playerSvgGroups[i];\n            g.rotate(180 * -player.angle / Math.PI);\n            g.translate(playerPos.x, playerPos.y);\n        });\n\n        applyTransition(previousCamFocus, gameData.camFocus);\n        previousCamFocus = gameData.camFocus;\n    };\n\n    const reset = () => {\n        layers.forEach(layer => {\n            let elem = s.select(\"#\" + layer.id).get(0) as SVG.G;\n            if (!!elem) {\n                elem.matrix(1, 0, 0, 1, 0, 0);\n            }\n        });\n\n        viewPort.zoomLevel(1);\n        viewPort.location({x:0, y:0});\n    };\n\n    const setup = async (players:Array<Player>) => {\n        reset();\n\n        // Performance: This is about not rendering svg elements that are not visible\n        let canvasWidth = s.node.getBoundingClientRect().width;\n        applyTransition = setupPartitions(canvasWidth, viewPort.width(), layers, s);\n\n        playerSvgGroups = players.map((player, i) => {\n            let g = (s.select(\"#player-layer\").get(0) as SVG.G).group();\n            g.style(\"color\", player.accentColor);\n            loadPlayerSvg(g, playerSvgs(resources)[i]);\n            return g;\n        });    \n    };\n\n    const teardown = () => {\n        while (playerSvgGroups.length) {\n            playerSvgGroups.pop().remove();\n        }\n    };\n    \n    return {\n        update,\n        setup,\n        teardown\n    };\n};\n\nexport const loadPlayerSvg = async (g:SVG.G, playerSvg:string) => {\n    let elem = (await loadSvg(playerSvg)).asElement();\n    let elemText = elem.getElementsByTagName('g')[0].outerHTML;\n    let scaleG = g.group();\n    let translateG = scaleG.group();\n    translateG.svg(elemText);\n    let bbox = g.bbox();\n    translateG.translate(-(bbox.x2 - bbox.width/2), -bbox.y2);\n    scaleG.scale(PLAYER_HEIGHT/bbox.height, \n        PLAYER_HEIGHT/bbox.height, \n        0, \n        0);\n};\n\n// cx: 90.29594612121582\n// cy: 104.9392204284668\n// h: 138.38157653808594\n// height: 138.38157653808594\n// w: 122.54891204833984\n// width: 122.54891204833984\n// x: 29.0214900970459\n// x2: 151.57040214538574\n// y: 35.74843215942383\n// y2: 174.13000869750977","import { createKeyboardInput } from \"./keyboardinput\";\nimport { PLAYER_HEIGHT, PlayerDef, Resources, playerSvgs, createSounds } from \"./defs\";\nimport SVG from \"svgjs\";\nimport { loadPlayerSvg } from \"./view\";\nimport { loadSvg, loadLevelJson } from \"./util\";\nimport howler from \"howler\";\n\nexport const createPlayerDefinitions = ():Array<PlayerDef> => {\n    let players = [\n        {\n            keyMap: {right: 90, left: 81, up: 83},\n            accentColor: \"#e46167\"\n        },\n        {\n            keyMap: {right: 78, left: 86, up: 71},\n            accentColor: \"#c47ec2\"\n        },\n        {\n            keyMap: {right: 39, left: 37, up: 38},\n            accentColor: \"#48baec\"\n        },\n        {\n            keyMap: {right: 104, left: 98, up: 100},\n            accentColor: \"#78bc78\"\n        }\n    ];\n\n    return players;\n};\n\nconst makeDiv = (className:string) => {\n    let div = document.createElement(\"div\");\n    div.className = className;\n    let container = document.getElementsByClassName(\"aspectRatioChild\")[0];\n    container.append(div);\n    return div;\n};\n\nconst preLoadResources = async (resources:Resources) => {\n    let ps:Array<Promise<void>> = [];\n\n    const awaitParallel = (f:()=>void) => {\n        ps.push(new Promise(async (res) => {\n            await f();\n            res();\n        }));\n    };\n\n    const awaitSound = async (url:string) => {\n        return await new Promise<Howl>(res => {\n            let howl = new Howl({\n                src: url,\n                onload: loaded\n              });\n\n            function loaded() {\n                res(howl);\n            }\n        });\n    }\n\n    awaitParallel(async () => await loadSvg(resources.levelSvg));\n    playerSvgs(resources).forEach(playerSvg => {\n        awaitParallel(async () => await loadSvg(playerSvg));\n    });\n    awaitParallel(async () => await loadLevelJson(resources.levelJson));\n\n    // //sounds\n    var music = new Howl({\n        src: resources.music,\n        loop: true,\n        volume: 0.6\n      });\n      \n      music.play();\n\n    resources.sounds = createSounds({\n        music,\n        collide: await awaitSound(resources.collide),\n        jump: await awaitSound(resources.jump),\n        pickninja1: await awaitSound(resources.pickninja1),\n        pickninja0: await awaitSound(resources.pickninja0),\n        gameover: await awaitSound(resources.gameover),\n        roundover: await awaitSound(resources.roundover),\n        land: await awaitSound(resources.land)\n    })\n\n    await Promise.all(ps);\n}\n\nexport const welcomeScreen = async (resources:Resources) => {\n    let welcomeDiv = makeDiv(\"welcome loading\");\n    let keyBoard = createKeyboardInput();\n\n    await preLoadResources(resources);\n    welcomeDiv.className = \"welcome\";\n    \n    await new Promise(resolve => keyBoard.onKeyDown(32, resolve));\n\n    keyBoard.off();\n    welcomeDiv.remove();\n};\n\nexport const story = async (storyname:string) => {\n    let story = makeDiv(storyname);\n    let keyBoard = createKeyboardInput();\n    \n    await new Promise(resolve => keyBoard.onKeyDown(32, resolve));\n\n    keyBoard.off();\n    story.remove();\n};\n\nexport const selectPlayers = async (s:SVG.Doc, resources:Resources) => {\n    let story = makeDiv(\"selectPlayers\");\n\n    let playerDefs = createPlayerDefinitions();\n    let participatingPlayers = new Set<PlayerDef>();\n    let keyBoard = createKeyboardInput();\n    \n    s.viewbox(-5, -5, 10, 10);\n    let toCleanup:Array<SVG.G> = [];\n\n    const participate = (p:PlayerDef, g:SVG.G) => () => {\n        if (!participatingPlayers.has(p)) {\n            resources.sounds.selectPlayer();\n        }\n        participatingPlayers.add(p);\n        g.opacity(1);\n    };\n\n    playerDefs.forEach((p, i) => {\n        let g = s.group()\n            .translate(-2.5 + i*5/3, PLAYER_HEIGHT/2)\n            .opacity(0.3)\n            .style(\"color\", p.accentColor);\n        loadPlayerSvg(g, playerSvgs(resources)[i]);\n        toCleanup.push(g);\n\n        let action = participate(p, g);\n        keyBoard.onKeyDown(p.keyMap.left, action);\n        keyBoard.onKeyDown(p.keyMap.right, action);\n        keyBoard.onKeyDown(p.keyMap.up, action);\n    })\n\n    await new Promise(resolve => keyBoard.onKeyDown(32, () => {\n        let atLeastTwoParticipants = participatingPlayers.size > 1;\n        if (atLeastTwoParticipants) {\n            resolve();\n        }\n    }));\n\n    keyBoard.off();\n    toCleanup.forEach(elem => elem.remove());\n    story.remove();\n    return Array.from(participatingPlayers.values());\n};","import { Editor } from \"./editor\";\nimport { createKeyboardInput, bindPlayerKeyboardInput } from \"./keyboardinput\";\nimport { GameLoop } from \"./gameloop\";\nimport { createGameData, createLayers, GameData, Resources, defineResources } from \"./defs\";\nimport { createViewPort } from \"./viewport\";\nimport { createPathDrawer } from \"./editor-graphics\";\nimport { createHeightMap, resetPlayersOnGround } from \"./heightmap\";\nimport { stepState } from \"./physics\";\nimport SVG from \"svgjs\";\nimport { test } from \"./test\";\nimport { createView } from \"./view\";\nimport { loadSvg, loadLevelJson, timeSinceOnlyOnPlayerStillInTheGame } from \"./util\";\nimport { welcomeScreen, selectPlayers, createPlayerDefinitions, story } from \"./welcome\";\n\nasync function startGame(resources:Resources) {\n\n    let svgId = \"mainsvg\";\n    let svgElement = document.getElementById(svgId);\n\n    await welcomeScreen(resources);\n    await story(\"story-1\");\n\n    let playerDefs = await selectPlayers(SVG(svgElement), resources); \n\n    let loadedSvg = (await loadSvg(resources.levelSvg)).asElement();\n    svgElement.replaceWith(loadedSvg);\n    let s = SVG(document.getElementById(svgId));\n\n    let heightMap = await loadLevelJson(resources.levelJson);\n    \n    let layers = createLayers();\n    let viewPort = createViewPort(s, layers);\n    \n    let view = createView(viewPort, s, layers, resources);\n    let gameLoop = GameLoop(stepState, view.update, resources);\n    \n    let keyboardinput = createKeyboardInput();\n    let gameData:GameData;\n\n    const RUN = () => {\n        gameData = createGameData(heightMap, playerDefs);\n        bindPlayerKeyboardInput(gameData.players, playerDefs, keyboardinput);\n        view.setup(gameData.players);\n        resetPlayersOnGround(gameData.players, heightMap, 1);\n        gameLoop.start(gameData);\n        resources.sounds.startGame();\n    };\n\n    RUN();\n    \n    let k = createKeyboardInput();\n    k.onKeyDown(32, () => {   \n        if (tryRestartGame(gameData)) {\n            view.teardown();\n            gameLoop.stop();\n\n            RUN();\n        }\n    });\n\n};\n\nconst tryRestartGame = (gameData:GameData) => {\n    if (gameData.isGameOver && timeSinceOnlyOnPlayerStillInTheGame(gameData) > 3000) {\n        gameData.isGameOver = false;\n        gameData.elapsedTime = 0;\n        gameData.players.forEach(p => p.score = 0);\n        return true;\n    }\n    return false;\n}\n\nconst startEditMode = (resources:Resources) => {\n    let svgId = \"mainsvg\";\n    let s = SVG(document.getElementById(svgId));\n\n    let layers = createLayers();\n\n    let heightMap = createHeightMap(1500);\n    let viewPort = createViewPort(s, layers);\n\n    let defaultPlayers = [createPlayerDefinitions()[2]]\n    \n    // Editor\n    let pathDrawer = createPathDrawer(s, heightMap, layers);\n    let editor = Editor(createGameData(heightMap, defaultPlayers), viewPort, pathDrawer);    \n\n    // Game\n    let view = createView(viewPort, s, layers, resources);\n    let gameLoop = GameLoop(stepState, view.update, resources);\n\n    let temporaryKeyboardInput = createKeyboardInput();\n    // Toggle Game/Editor\n    createKeyboardInput().onKeyDown(32, () => {   // Space\n        temporaryKeyboardInput.off();\n\n        let editorVisible = editor.toggle();\n        if (editorVisible) {\n            gameLoop.stop();\n            view.teardown();\n        }\n        else {\n            let gameData = createGameData(heightMap, defaultPlayers);\n            view.setup(gameData.players);\n            \n            resetPlayersOnGround(gameData.players, heightMap, 1);\n            bindPlayerKeyboardInput(gameData.players, defaultPlayers, temporaryKeyboardInput);\n            gameLoop.start(gameData);\n        }\n    });\n\n    editor.toggle(true);\n};\n\nfunction main() {\n\n    test();\n    let href = window.location.href;\n\n    if (href.search(/\\?edit/) > -1) {\n        // ENTER EDIT MODE\n        startEditMode(defineResources(\"none\"));\n    }\n    else {\n        // ENTER GAMING MODE\n        let levelname = \"level\";\n        if (href.search(/\\?level=/) > -1) {\n            levelname = href.split(\"?level=\")[1];\n        }\n\n        startGame(defineResources(levelname));\n    }\n};\n\nmain();"],"names":[],"mappings":"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"}